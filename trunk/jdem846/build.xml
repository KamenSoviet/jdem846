<project name="jdem846" default="jar" basedir=".">

	<property file="build.properties" />
	<property name="lib.dir" value="lib" />
	<property name="src.dir" value="src" />
	<property name="build.dir" value="build" />
	<property name="javadoc.dir" value="docs/api" />
	<property name="dist.dir" value="dist" />
	
	<property name="jar.file" value="${application.name}.jar" />
	<property name="dist.file" value="${dist.dir}/${application.name}-${application.version}.zip" />

		
	<fileset id="lib" dir="${lib.dir}">
		<include name="*.jar" />
	</fileset>
	
	<patternset id="ignored.files">
		<exclude name="**/.svn/**" />
	</patternset>
	
	<patternset id="compiler.resources">
		<include name="**/?*.properties" />
		<include name="**/?*.xml" />
		<include name="**/?*.gif" />
		<include name="**/?*.png" />
		<include name="**/?*.jpeg" />
		<include name="**/?*.jpg" />
		<include name="**/?*.html" />
		<include name="**/?*.gradient" />
		<include name="**/?*.txt" />
	</patternset>
	
	<patternset id="lib.resources">
		<include name="**/?*.jar" />
	</patternset>
	
	<path id="build.sourcepath">
			<dirset dir=".">
				<include name="src" />
			</dirset>
	</path>
	
	<path id="build.classpath">
		<fileset refid="lib" />
	</path>
	
	<target name="init" description="Initialize the build">
		<mkdir dir="${build.dir}" />
		<mkdir dir="${dist.dir}" />
	</target>
		
	<target name="compile" depends="init" description="">
		<javac destdir="${build.dir}" debug="${compiler.debug}" nowarn="${compiler.generate.no.warnings}" memorymaximumsize="${compiler.max.memory}" fork="true">
					<compilerarg line="${compiler.args}" />
					<classpath refid="build.classpath" />
					<src refid="build.sourcepath" />
					<patternset refid="ignored.files" />
		</javac>
		<copy todir="${build.dir}">
			<fileset dir="${src.dir}">
				<patternset refid="compiler.resources" />
				<type type="file" />
			</fileset>
		</copy>
		
	</target>
	
	<target name="jar" depends="compile">
		<jar destfile="${jar.file}" duplicate="add">
			<zipfileset dir="${build.dir}" />
			<manifest>
				<attribute name="Main-Class" value="${main.class}"/>
			</manifest>
		</jar>
	</target>
	
	<target name="clean">
		<delete dir="${build.dir}" />
		<delete dir="${dist.dir}" />
		<delete dir="${javadoc.dir}" />
	</target>

	<target name="javadoc">
		  <javadoc
		           destdir="${javadoc.dir}"
		  		   sourcepath="${src.dir}"
		           author="true"
		           version="true"
		           use="true"
		           windowtitle="jDem846 API">


		    <doctitle><![CDATA[<h1>jDem846</h1>]]></doctitle>
		    <bottom><![CDATA[<i>Copyright &#169; 2011 Kevin M. Gill. All Rights Reserved.</i>]]></bottom>
		</javadoc>
	</target>
	
	<target name="dist" depends="jar,javadoc">
		<mkdir dir="${dist.dir}/stage/lib" />
		<mkdir dir="${dist.dir}/stage/docs/api" />
		<copy file="${jar.file}" todir="${dist.dir}/stage" />
		<copy file="LICENSE" todir="${dist.dir}/stage" />
		<copy file="NOTICE" todir="${dist.dir}/stage" />
		<copy file="jdem.bat" todir="${dist.dir}/stage" />
		<copy file="jdem.sh" todir="${dist.dir}/stage" />
		<copy todir="${dist.dir}/stage/lib">
			<fileset dir="${lib.dir}">
				<patternset refid="lib.resources" />
				<type type="file" />
			</fileset>
		</copy>
		<copy todir="${dist.dir}/stage/docs/api">
			<fileset dir="${javadoc.dir}">
			</fileset>
		</copy>
		<copy file="${src.dir}/us/wthr/jdem846/images/jdem846-icon.png" todir="${dist.dir}/stage" />
		<zip destfile="${dist.file}" duplicate="add">
			<zipfileset dir="${dist.dir}/stage" />
		</zip>
		
		<delete dir="${dist.dir}/stage" />
	</target>
</project>